# Tech Challenge - P√≥s-Tech SOAT - FIAP
# Fase 2

Alunos:

* Andr√© Mattos - RM358905
* Aurelio Thomasi Jr - RM358104
* Leonardo Ramires - RM358190
* Lucas Arruda - RM358628
* Pedro Marins - RM356883

## Evid√™ncias do projeto
- [Link para o reposit√≥rio](https://github.com/leonardoramires/fiap-ia4devs)
- [Link para o v√≠deo do projeto](https://youtu.be/LQtUcsGbxds)

## Como rodar o projeto

1. Clonar o reposit√≥rio
   ```bash
   git clone https://github.com/leonardoramires/fiap-ia4devs.git
   ```
2. Instalar as depend√™ncias
   ```bash
   pip install -r fase2/requirements.txt
   ```
3. Rodar o projeto
   ```bash
   python fase2/main.py
   ```

> **Sobre instala√ß√£o das depend√™ncias**: √â recomend√°vel utilizar o ambiente virtual do Python para instalar as depend√™ncias, utilizando o comando `python -m venv .venv` e depois ativar o ambiente virtual com o comando `source .venv/bin/activate`.

## Defini√ß√£o do Problema
O problema consiste em alocar ordens de servi√ßo (OS) de manuten√ß√£o para operadores de forma otimizada, considerando as habilidades necess√°rias para cada ordem e as habilidades dos operadores dispon√≠veis. 
O problema a ser resolvido √© maximizar a produtividade operacional, assegurando o cumprimento dos prazos estabelecidos, evitar horas extras desnecess√°rias e garantir que as ordens sejam atendidas dentro do prazo estipulado.

## Objetivos
O projeto aborda o desafio cr√≠tico de otimiza√ß√£o na aloca√ß√£o de ordens de servi√ßo (OS) de manuten√ß√£o. Atrav√©s de um algoritmo especializado, o sistema realiza o pareamento preciso entre as compet√™ncias t√©cnicas dos operadores e as exig√™ncias espec√≠ficas de cada ordem.

Alocar ordens de servi√ßo de forma eficiente, maximizando a compatibilidade entre as habilidades dos operadores e as habilidades necess√°rias para as ordens.
Minimizar o n√∫mero de horas extras trabalhadas pelos operadores.
Garantir que as ordens de maior prioridade sejam atendidas dentro do prazo.

## O Projeto
![Fluxograma do Algoritmo Gen√©tico](assets/fluxograma.jpeg)

*Figura 1: Fluxograma do Algoritmo Gen√©tico*

Este projeto foi desenvolvido utilizando um algoritmo gen√©tico para otimizar a aloca√ß√£o de ordens de servi√ßo aos operadores. As seguintes informa√ß√µes relevantes sobre as ordens e operadores s√£o utilizadas para a otimiza√ß√£o:

- **Dados das ordens**: Incluem o tempo estimado de execu√ß√£o, habilidades necess√°rias, prioridade, status, e o dia esperado de in√≠cio do atendimento.
- **Dados dos operadores**: Cont√™m as habilidades dispon√≠veis, n√≠vel de qualifica√ß√£o e horas dispon√≠veis.

Abaixo est√£o os pontos essenciais desta solu√ß√£o, com os principais detalhes:

### 1. Reajuste nas Fun√ß√µes de Aptid√£o
- ‚ú® Adi√ß√£o de pesos considerando a prioridade da OS
- üìä Penaliza√ß√£o proporcional por horas extras

### 2. Otimiza√ß√£o do Crossover
- üîÑ Crossover em dois segmentos com ponto de corte aleat√≥rio
- üìä Valida√ß√£o de compatibilidade de habilidades (m√≠nimo 50%)
- üîí Garantia de atribui√ß√£o √∫nica para cada ordem
- üéØ Realoca√ß√£o aleat√≥ria de ordens n√£o atribu√≠das

### 3. Processo de Muta√ß√£o Inteligente
- üß¨ Taxa de muta√ß√£o adaptativa (reduz ao longo das gera√ß√µes)
- üéØ Valida√ß√£o de compatibilidade de habilidades do operador
- üîÑ Verifica√ß√£o da qualidade p√≥s-muta√ß√£o
- ‚Ü©Ô∏è Revers√£o autom√°tica de muta√ß√µes prejudiciais

### 4. Sistema de Elitismo
- üèÜ Preserva√ß√£o dos N melhores indiv√≠duos (5 melhores por default)
- üìà Manuten√ß√£o de solu√ß√µes de alta qualidade entre gera√ß√µes

> **Sobre o elitismo**: Os 5 melhores indiv√≠duos s√£o preservados entre as gera√ß√µes. Se o elitismo for alterada para 7, os 7 melhores indiv√≠duos seriam preservados.

### 5. Gest√£o Populacional
- üîÑ Reinicializa√ß√£o parcial peri√≥dica (metade da popula√ß√£o)
- üéØ Preven√ß√£o de converg√™ncia prematura para uma solu√ß√£o sub√≥tima

### 6. Controle de Qualifica√ß√£o
- ‚úÖ Exig√™ncia m√≠nima de 50% das habilidades necess√°rias
- üö´ Preven√ß√£o de aloca√ß√µes inadequadas

## Detalhamento do Algoritmo Gen√©tico

### 1. Gera√ß√£o da Popula√ß√£o Inicial üå±
A popula√ß√£o inicial consiste em um conjunto de solu√ß√µes (indiv√≠duos) geradas aleatoriamente, onde cada solu√ß√£o representa uma poss√≠vel aloca√ß√£o de ordens de servi√ßo ao longo do per√≠odo de 5 dias.
Tamb√©m existe uma op√ß√£o de gerar a popula√ß√£o inicial com base em uma solu√ß√£o pr√©-definida.

#### Processo de Gera√ß√£o:
- **Inicializa√ß√£o**: Estrutura base `{"orders": {order_id: {"day": None, "operator": None, "status": "n√£o atendida"}}, "fitness": 0}`
- **Valida√ß√£o de Habilidades**: Filtra operadores v√°lidos com habilidades m√≠nimas necess√°rias
- **Distribui√ß√£o Aleat√≥ria**: Para cada ordem:
  - Atribui dia aleat√≥rio (1 a N dias)
  - Seleciona operador compat√≠vel aleatoriamente
  - Define status baseado no prazo esperado (stats poss√≠veis: "n√£o atendida", "atendida", "atrasada")

### 2. Processo de Sele√ß√£o üéØ
Utilizamos um processo de sele√ß√£o adaptativo para selecionar os pais para a pr√≥xima gera√ß√£o.
Esse processo √© feito atrav√©s dos seguintes passos:

### 3. Processo de Crossover üîÑ
O Crossover √© feito atrav√©s de dois segmentos, com as seguintes caracter√≠sticas:

#### Metodologia do Crossover:
1. **Inicializa√ß√£o**:
   - Cria filho vazio: `{"orders": {}, "fitness": 0}`
   - Garante unicidade das ordens a serem distribuidas (Utiliza√ß√£o da estrutura de dados set para garantir a unicidade)

2. **Sele√ß√£o do Ponto**:
   - Escolha aleat√≥ria do ponto de divis√£o na lista de ordens
   - `crossover_point = random.randint(1, len(orders_parent1) - 1)`

3. **Primeiro Segmento**:
   - Copia ordens do pai 1 at√© o ponto de crossover
   - Adiciona apenas se ordem n√£o foi atribu√≠da anteriormente

4. **Segundo Segmento**:
   - Copia ordens do pai 2 ap√≥s o ponto de crossover
   - Evita duplica√ß√£o de ordens

5. **Tratamento de Ordens N√£o Atribu√≠das**:
   - Identifica ordens que n√£o foram atribu√≠das
   - Atribui aleatoriamente a operadores compat√≠veis
   - Define dia e status baseado no prazo esperado (stats poss√≠veis: "n√£o atendida", "atendida", "atrasada")

### 4. Processo de Muta√ß√£o üß¨
A muta√ß√£o introduz varia√ß√µes nas solu√ß√µes que s√£o feitas para manter a diversidade gen√©tica e evitar a converg√™ncia prematura para uma solu√ß√£o sub√≥tima. Como foi descrito no fluxograma, a muta√ß√£o √© feita atrav√©s dos seguintes passos:

#### Procedimento:
1. **Taxa de Muta√ß√£o Adaptativa**:
   - Cada solu√ß√£o tem chance de `_MUTATION_RATE` de sofrer muta√ß√£o
   - Altera√ß√µes podem incluir novo dia ou operador para ordens selecionadas

2. **Reinicializa√ß√£o Peri√≥dica**:
   - A cada 10 gera√ß√µes (valor default)
   - Novas solu√ß√µes s√£o geradas aleatoriamente para metade da popula√ß√£o com o menor fitness.
   - Fitness √© recalculado para novos indiv√≠duos

3. **Valida√ß√µes**:
   - Verifica compatibilidade de habilidades do novo operador
   - Atualiza status (atendida/atrasada) baseado no novo dia
   - Recalcula o fitness ap√≥s muta√ß√£o

4. **Preserva√ß√£o de Elite**:
- Os 5 melhores indiv√≠duos s√£o preservados (5 √© um valor default)
- Garante que boas solu√ß√µes n√£o sejam perdidas

5. **Controle de Qualidade**:
   - Compara fitness antes e depois da muta√ß√£o
   - Reverte mudan√ßas se o fitness piorar, para evitar a converg√™ncia prematura para uma solu√ß√£o sub√≥tima

### 5. Fun√ß√£o de Aptid√£o ‚öñÔ∏è
A fun√ß√£o Fitness avalia a qualidade das solu√ß√µes considerando m√∫ltiplos crit√©rios.
Os crit√©rios de avalia√ß√£o s√£o os seguintes:

#### Crit√©rios de Avalia√ß√£o:
1. **Compatibilidade de Habilidades**:
   - Verifica√ß√£o se operador possui as habilidades necess√°rias para a ordem
   - Pontua√ß√£o positiva para matches completos
   - Penalidades para incompatibilidades

2. **Gest√£o de Prazos e Status**:
   - Verifica√ß√£o do in√≠cio esperado vs. dia alocado
   - Status atualizado como "atendida" ou "atrasada" baseado no prazo
   - Prioriza√ß√£o de ordens urgentes e alta prioridade

3. **Controle de Capacidade**:
   - Monitoramento de horas por operador por dia
   - Respeito √†s horas dispon√≠veis por turno (evitar horas extras)
   - Distribui√ß√£o balanceada entre operadores

4. **Otimiza√ß√£o Evolutiva e par√¢metros configur√°veis do algoritmo**:
   - N√∫mero de dias organizados pela execu√ß√£o do algoritmo (configur√°vel via `_DAYS`)
   - N√∫mero de operadores dispon√≠veis (configur√°vel via `_N_OPERATORS`)
   - N√∫mero de ordens de servi√ßo a serem alocadas (configur√°vel via `_N_ORDERS`)
   - Popula√ß√£o inicial de 50 indiv√≠duos (configur√°vel via `_POPULATION_SIZE`)
   - Execu√ß√£o por 50 gera√ß√µes (configur√°vel via `_GENERATIONS`)
   - Taxa de muta√ß√£o de 30% (configur√°vel via `_MUTATION_RATE`)
   - Elitismo preservando os 5 melhores indiv√≠duos (configur√°vel via `_ELITISM_SIZE`)
   - Reinicializa√ß√£o de 50% da popula√ß√£o a cada 10 gera√ß√µes (configur√°vel via `_REINITIALIZE_INTERVAL`)

5. **Finaliza√ß√£o dos algoritmos**:
   - Sele√ß√£o da melhor solu√ß√£o
   - C√°lculo das m√©tricas finais:
     - Total de ordens alocadas e n√£o alocadas
     - Distribui√ß√£o por prioridade
     - Distribui√ß√£o por dia
     - Horas extras por operador
   - Gera√ß√£o de relat√≥rios comparativos (incluindo valor de fitness):
     - Algoritmo Gen√©tico
     - Aloca√ß√£o Humana
     - Algoritmo Guloso
     - Programa√ß√£o Linear
   - Convers√£o para DataFrame com detalhes de:
     - Aloca√ß√£o ordem-operador
     - Compatibilidade de habilidades
     - Status de atendimento
     - Controle de horas extras
   - Visualiza√ß√£o interativa com PyGame do calend√°rio de aloca√ß√µes

### 6. Relat√≥rio com PyGame üéÆ
![Relat√≥rio com PyGame](assets/relatorio.gif)

*Figura 2: Relat√≥rio com PyGame*

Este relat√≥rio foi gerado utilizando a biblioteca PyGame, que √© uma biblioteca Python para cria√ß√£o de jogos e simula√ß√µes. O relat√≥rio √© respons√°vel por exibir o resultado do algoritmo gen√©tico de forma visual, mostrando a aloca√ß√£o das ordens de servi√ßo aos operadores ao longo do per√≠odo de 5 dias, em formato de um calend√°rio.

## Informa√ß√µes gerais sobre o resultado do algoritmo
A an√°lise dos resultados do algoritmo gen√©tico para aloca√ß√£o de ordens de servi√ßo de manuten√ß√£o revela aspectos importantes sobre sua performance e limita√ß√µes. O algoritmo foi desenvolvido para otimizar a distribui√ß√£o de 100 ordens de servi√ßo entre 15 operadores ao longo de 5 dias, considerando m√∫ltiplas vari√°veis como habilidades t√©cnicas, prioridades e prazos.

### 1. üîÑ Compara√ß√£o com outros algoritmos
Outros algoritmos foram utilizados por ordem de realizar a compara√ß√£o, como o algoritmo guloso, o algoritmo de programa√ß√£o linear e a aloca√ß√£o humana.
Esta compara√ß√£o foi realizada com base no fitness das solu√ß√µes encontradas pelos algoritmos, que √© uma medida da qualidade da solu√ß√£o encontrada. O resultado desta compara√ß√£o pode ser visto na se√ß√£o üìä Estat√≠sticas gerais do algoritmo.

### 2. üìä Estat√≠sticas gerais do algoritmo

#### Informa√ß√µes gerais sobre as ordens:
| M√©trica | Valor |
|---------|-------|
| Total de Ordens | 100 |
| Ordens Alocadas | 85 (85.0%) |
| Ordens N√£o Alocadas | 15 |

O algoritmo conseguiu alocar 85% das ordens de servi√ßo.

#### An√°lise por prioridade:
| Prioridade | Quantidade | Percentual |
|------------|------------|------------|
| Urgente | 20 | 23.5% |
| Alta | 29 | 34.1% |
| M√©dia | 24 | 28.2% |
| Baixa | 12 | 14.1% |

#### Ordens n√£o alocadas:
Neste caso, o algoritmo n√£o conseguiu alocar 15 ordens de servi√ßo.

#### Compara√ß√£o de Fitness entre os algoritmos
| Algoritmo | Fitness |
|-----------|---------|
| Greedy Algorithm | 400.0 |
| Linear Programming | -1005.0 |
| Aloca√ß√£o Humana | 615.0 |
| Genetic Algorithm | 1095.0 |

Como podemos ver, o algoritmo gen√©tico foi o que obteve o melhor resultado, seguido pela aloca√ß√£o humana.

#### Distribui√ß√£o por dia
Resumo das ordens alocadas por dia:

| Dia | Total de Ordens | Horas Alocadas | Urgente | Alta | M√©dia | Baixa |
|-----|----------------|----------------|----------|------|-------|-------|
| 1 | 18 | 80.0h | 17 | 1 | 0 | 0 |
| 2 | 18 | 80.0h | 3 | 14 | 1 | 0 |
| 3 | 16 | 76.0h | 0 | 14 | 2 | 0 |
| 4 | 18 | 80.0h | 0 | 0 | 15 | 3 |
| 5 | 15 | 76.0h | 0 | 0 | 6 | 9 |

### Dados dos operadores
| operator_id | skills | level | shift | hours_per_day |
|------------|--------|-------|-------|---------------|
| op1 | pintura \| el√©trica \| solda | s√™nior | manh√£ | 7 |
| op2 | el√©trica \| pintura \| alvenaria | j√∫nior | manh√£ | 7 |
| op3 | pintura \| el√©trica \| hidr√°ulica | s√™nior | noite | 7 |
| op4 | pintura \| alvenaria \| el√©trica | pleno | tarde | 9 |
| op5 | pintura \| hidr√°ulica | pleno | tarde | 9 |
| op6 | solda \| hidr√°ulica | especialista | tarde | 7 |
| op7 | pintura \| el√©trica \| alvenaria | j√∫nior | tarde | 9 |
| op8 | el√©trica \| pintura \| solda | s√™nior | tarde | 7 |
| op9 | pintura \| solda | j√∫nior | tarde | 8 |
| op10 | solda \| el√©trica \| pintura | pleno | manh√£ | 9 |
| op11 | el√©trica \| alvenaria \| solda | s√™nior | manh√£ | 7 |
| op12 | hidr√°ulica \| alvenaria | s√™nior | noite | 9 |
| op13 | hidr√°ulica \| solda | j√∫nior | tarde | 8 |
| op14 | solda \| el√©trica | especialista | manh√£ | 8 |
| op15 | alvenaria \| el√©trica \| hidr√°ulica | especialista | manh√£ | 9 |

### Dados das ordens
| id_ordem | Servi√ßos | horas_estimadas | prioridade | inicio_esperado | status |
|----------|----------|-----------------|------------|-----------------|---------|
| os1 | el√©trica | 5 | m√©dia | 4 | n√£o_atendida |
| os2 | hidr√°ulica | 8 | alta | 1 | n√£o_atendida |
| os3 | hidr√°ulica \| pintura | 5 | m√©dia | 2 | n√£o_atendida |
| os4 | hidr√°ulica | 7 | baixa | 2 | n√£o_atendida |
| os5 | alvenaria | 2 | alta | 4 | n√£o_atendida |
| os96 | solda \| pintura | 8 | baixa | 5 | n√£o_atendida |
| os97 | solda \| hidr√°ulica | 2 | urgente | 1 | n√£o_atendida |
| os98 | hidr√°ulica | 5 | m√©dia | 5 | n√£o_atendida |
| os99 | el√©trica | 2 | alta | 1 | n√£o_atendida |
| os100 | hidr√°ulica | 3 | m√©dia | 5 | n√£o_atendida |

[100 rows x 6 columns]

### Dados das ordens atribu√≠das aos operdores (shape = (100, 17))
| dia | id_ordem | id_operador | Servi√ßos | compatibilidade_prioridade | hora_extra | total_hora_extra | status |
|-----|----------|-------------|-----------|---------------------------|------------|------------------|---------|
| 4 | os22 | op1 | solda \| pintura | OK | N√£o | -2 | atendida |
| 1 | os36 | op1 | el√©trica | OK | N√£o | -3 | atendida |
| 1 | os49 | op1 | el√©trica | OK | Sim | 2 | atendida |
| 5 | os55 | op1 | pintura \| solda | OK | N√£o | 0 | atendida |
| 2 | os68 | op1 | el√©trica | OK | Sim | 1 | atendida |
| ... | ... | ... | ... | ... | ... | ... | ... |
| 2 | os30 | op9 | hidr√°ulica \| pintura | OK | N√£o | 0 | atendida |
| 1 | os48 | op9 | solda | OK | N√£o | -6 | atendida |
| 3 | os78 | op9 | solda | OK | N√£o | -1 | atendida |
| 1 | os90 | op9 | alvenaria \| solda | NOK | N√£o | -1 | atendida |
| 4 | os96 | op9 | solda \| pintura | OK | N√£o | 0 | atendida |
